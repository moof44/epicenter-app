<div class="page-container">
      <div class="check-in-container">
        <div class="list-header">
          <h2 class="list-title">Member Check-in</h2>
        </div>

        <div class="search-container">
          <input
            type="text"
            placeholder="Search for a member..."
            class="search-input"
            [value]="searchTerm()"
            (input)="handleSearchInput($event)"
          />
        </div>

        @if (filteredMembers().length > 0) {
          <ul class="member-list">
            @for (member of filteredMembers(); track member.id) {
              <li (click)="selectMember(member)" class="member-list-item">{{ member.name }}</li>
            }
          </ul>
        }

        @if (selectedMember(); as member) {
          <div class="member-details">
            <h2 class="details-title">Selected Member: {{ member.name }} ({{member.gender}})</h2>
            @if (!isMemberCheckedIn(member.id)) {
              <div class="locker-assignment">
                <label for="locker">Assign Locker?</label>
                <input type="checkbox" id="locker" [checked]="assignLocker()" (change)="handleLockerChange($event)" />
              </div>

              @if (assignLocker()) {
                <select [ngModel]="selectedLocker()" (ngModelChange)="selectedLocker.set($event)" class="locker-select">
                  @for (locker of availableLockers(); track locker.id) {
                    <option [value]="locker.number">Locker {{ locker.number }}</option>
                  }
                </select>
              }

              <button (click)="checkIn()" class="check-in-button">Check-in</button>
            } @else {
              <button (click)="checkOut(member.id)" class="check-out-button">Check-out</button>
            }
          </div>
          
          <div class="attendance-history">
            <h3 class="history-title">Attendance History</h3>
            @if(memberAttendanceHistory().length > 0) {
              <ul class="history-list">
                  @for(attendance of memberAttendanceHistory(); track attendance.id) {
                      <li class="history-list-item">
                          <span>Check-in: {{ attendance.checkInTime | date:'short' }}</span>
                          @if(attendance.checkOutTime) {
                              <span>Check-out: {{ attendance.checkOutTime | date:'short' }}</span>
                          }
                          @if(attendance.lockerNumber) {
                              <span>Locker: {{ attendance.lockerNumber }}</span>
                          }
                      </li>
                  }
              </ul>
            } @else {
              <p>No attendance history for this member.</p>
            }
          </div>
        }
      </div>

      <div class="checked-in-container">
        <div class="list-header">
          <h2 class="list-title">Currently Checked-in</h2>
        </div>
        @if (checkedInMembers().length > 0) {
          <ul class="checked-in-list">
            @for (item of checkedInMembers(); track item.id) {
              <li class="checked-in-list-item">
                <div>
                  <p class="member-name">{{ item.memberName }}</p>
                  <p class="check-in-time">Checked-in: {{ item.checkInTime | date:'shortTime' }}</p>
                  @if(item.lockerNumber) {
                    <p class="locker-number">Locker: {{ item.lockerNumber }}</p>
                  }
                </div>
                <button (click)="checkOut(item.memberId)" class="check-out-button-small">Check-out</button>
              </li>
            }
          </ul>
        } @else {
          <p>No members are currently checked in.</p>
        }
      </div>
    </div>